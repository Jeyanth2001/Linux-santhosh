# name: Build and Deploy

# on:
#   push:
#     branches:
#       - main
#   schedule:
#       - cron: '40 02 * * *'\
name: Scheduled Build and Deploy

on:
  schedule:
    - cron: '50 14 * * *'

jobs:
  build:
    runs-on: self-hosted
    #if: github.event_name == 'schedule' && contains(github.event.schedule, '40 02 * * *')
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Install dependencies
        run: |
          npm install

      - name: Build
        run: |
          npm run build

  deploy:
     runs-on: self-hosted
     #if: github.event_name == 'schedule' && contains(github.event.schedule, '40 02 * * *')
     needs: build
     steps:
       #- name: Debug Information
       #  run: |
       #    echo "GitHub Event Name: ${{ github.event_name }}"
       #    echo "GitHub Event Schedule: ${{ github.event.schedule }}"
       #    echo "Current directory: $(pwd)"
       #    echo "List files in the current directory: $(ls -al)"
       #    echo "GitHub Event: ${{ toJson(github.event) }}"
       #- name: Checkout code
       #  uses: actions/checkout@v2

       - name: deploy
         run: |
           cd /home/icanio-10091/Music/Linux-santhosh
           git stash && git pull
           pm2 ls
           pm2 delete react
           pm2 start npm --name react -- start
